<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Ø´Ø§Øª Ø¯Ø±Ø¯Ø´Ø© Ø§Ø­ØªØ±Ø§ÙÙŠ</title>
<style>
  /* Ø§Ø³ØªØ§ÙŠÙ„Ø§Øª Ø¹Ø§Ù…Ø© */
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }
  
  body {
    margin: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #1e3c72, #2a5298);
    background-size: cover;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    color: #333;
    transition: background-image 0.5s ease;
  }

  /* Ø­Ø§ÙˆÙŠØ© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
  .login-container {
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    background-color: rgba(0,0,0,0.7);
    z-index: 10;
    backdrop-filter: blur(5px);
  }

  #loginBox {
    background: rgba(255,255,255,0.95);
    padding: 30px;
    border-radius: 15px;
    width: 90%;
    max-width: 400px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    text-align: center;
    animation: fadeIn 0.8s ease;
  }

  #loginBox h2 {
    text-align: center;
    margin-bottom: 25px;
    color: #2a5298;
    font-size: 1.8rem;
  }

  #loginBox input {
    width: 100%;
    padding: 15px;
    font-size: 16px;
    border-radius: 10px;
    border: 2px solid #ddd;
    margin-bottom: 20px;
    transition: all 0.3s;
  }

  #loginBox input:focus {
    border-color: #2a5298;
    box-shadow: 0 0 8px rgba(42, 82, 152, 0.3);
    outline: none;
  }

  #loginBox button {
    width: 100%;
    padding: 15px;
    font-size: 16px;
    border: none;
    border-radius: 10px;
    color: white;
    cursor: pointer;
    margin-top: 10px;
    font-weight: 600;
    transition: transform 0.2s, background-color 0.3s;
  }

  #loginBox button:hover {
    transform: translateY(-2px);
  }

  #loginBtn {
    background: linear-gradient(to right, #2a5298, #1e3c72);
  }

  #loginBtn:hover {
    background: linear-gradient(to right, #1e3c72, #2a5298);
  }

  /* Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø´Ø§Øª */
  #chatContainer {
    display: none;
    flex-direction: column;
    width: 95%;
    height: 90vh;
    max-width: 1000px;
    background: rgba(255,255,255,0.95);
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 15px 40px rgba(0,0,0,0.25);
    transition: background-color 0.5s;
  }

  /* Ø±Ø£Ø³ Ø§Ù„Ø´Ø§Øª */
  .chat-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: linear-gradient(to right, #2a5298, #1e3c72);
    padding: 15px 20px;
    color: white;
    box-shadow: 0 3px 10px rgba(0,0,0,0.15);
  }

  /* Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… */
  #userNameDisplay {
    font-weight: bold;
    font-size: 1.2em;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .user-icon {
    background: #fff;
    color: #2a5298;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
  }

  /* Ø£Ø²Ø±Ø§Ø± ÙÙŠ Ø§Ù„Ø±Ø£Ø³ */
  #headerButtons {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .header-btn {
    background: rgba(255,255,255,0.15);
    border: none;
    padding: 8px 15px;
    border-radius: 6px;
    color: white;
    cursor: pointer;
    font-size: 0.9em;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    gap: 5px;
  }

  .header-btn:hover {
    background: rgba(255,255,255,0.25);
    transform: translateY(-2px);
  }

  #logoutBtn {
    background: rgba(220, 53, 69, 0.8);
  }

  #logoutBtn:hover {
    background: rgba(167, 29, 42, 0.9);
  }

  /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */
  .messages {
    flex: 1;
    padding: 15px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    background: rgba(245, 247, 250, 0.7);
    transition: background-color 0.5s;
    
    /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯ */
    scrollbar-width: thin;
    scrollbar-color: #2a5298 rgba(245, 247, 250, 0.5);
  }

  /* ØªØ®ØµÙŠØµ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± */
  .messages::-webkit-scrollbar {
    width: 10px;
  }

  .messages::-webkit-scrollbar-track {
    background: rgba(245, 247, 250, 0.5);
    border-radius: 5px;
  }

  .messages::-webkit-scrollbar-thumb {
    background: #2a5298;
    border-radius: 5px;
    border: 2px solid rgba(245, 247, 250, 0.5);
  }

  .messages::-webkit-scrollbar-thumb:hover {
    background: #1e3c72;
  }

  /* ÙƒÙ„ Ø±Ø³Ø§Ù„Ø© */
  .message {
    display: flex;
    align-items: flex-start;
    margin-bottom: 15px;
    max-width: 100%;
    animation: fadeIn 0.3s ease;
  }

  /* Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø±Ø§ÙÙ‚ Ù„Ù„Ø±Ø³Ø§Ù„Ø© */
  .sender-name {
    font-weight: bold;
    margin-right: 10px;
    flex-shrink: 0;
    cursor: default;
    color: #2a5298;
    display: flex;
    align-items: center;
    gap: 5px;
  }

  .sender-icon {
    background: #2a5298;
    color: white;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8em;
    font-weight: bold;
  }

  /* Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‚Ø§Ø¨Ù„ Ù„Ù„Ù†Ù‚Ø± ÙÙ‚Ø· Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„ */
  .sender-name.clickable {
    cursor: pointer;
    text-decoration: underline;
  }

  .sender-name.clickable:hover {
    color: #1e3c72;
  }

  /* Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø© */
  .message-content {
    background-color: #fff;
    padding: 12px 18px;
    border-radius: 18px;
    position: relative;
    max-width: 80%;
    word-wrap: break-word;
    transition: background-color 0.3s;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    border: 1px solid #eaeaea;
  }

  /* ØªØºÙŠÙŠØ± Ù„ÙˆÙ† Ø§Ù„Ù†Øµ Ø¹Ù†Ø¯ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙŠØ²Ø© */
  .message-text {
    font-size: 1em;
    line-height: 1.5;
  }

  /* Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø±Ø³Ù„Ø© Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… */
  .sent {
    flex-direction: row-reverse;
    align-self: flex-end;
  }

  /* Ø®Ù„ÙÙŠØ© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø±Ø³Ù„Ø© */
  .sent .message-content {
    background-color: #e3f2fd;
    border: 1px solid #bbdefb;
  }

  /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
  .input-area {
    display: flex;
    padding: 15px;
    background: rgba(255,255,255,0.9);
    border-top: 1px solid #eee;
    gap: 10px;
  }

  #messageInput {
    flex: 1;
    padding: 15px;
    border-radius: 25px;
    border: 2px solid #e0e0e0;
    outline: none;
    font-size: 16px;
    transition: all 0.3s;
  }

  #messageInput:focus {
    border-color: #2a5298;
    box-shadow: 0 0 10px rgba(42, 82, 152, 0.2);
    outline: none;
  }

  /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
  .input-btn {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    border: none;
    color: white;
    font-size: 1.2em;
    cursor: pointer;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 3px 8px rgba(0,0,0,0.15);
  }

  .input-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 5px 12px rgba(0,0,0,0.2);
  }

  /* Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ */
  #sendBtn {
    background: linear-gradient(to right, #2a5298, #1e3c72);
  }

  /* Ø²Ø± Ø§Ù„Ù…Ø§ÙŠÙƒØ±ÙˆÙÙˆÙ† Ù„Ø¥Ø±Ø³Ø§Ù„ ØµÙˆØª */
  #voiceBtn {
    background: linear-gradient(to right, #28a745, #218838);
    position: relative;
  }

  /* Ø²Ø± Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ± */
  #imageBtn {
    background: linear-gradient(to right, #ff9800, #f57c00);
  }

  /* Ø²Ø± Ù…Ø³Ø­ */
  #deleteBtn {
    background: linear-gradient(to right, #f44336, #d32f2f);
    display: none; /* Ù…Ø®ÙÙŠ Ø¨Ø´ÙƒÙ„ Ø§ÙØªØ±Ø§Ø¶ÙŠ */
  }

  /* Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
  @media(max-width: 768px) {
    #messageInput {
      font-size: 14px;
      padding: 12px;
    }
    
    .input-btn {
      width: 45px;
      height: 45px;
    }
    
    .header-btn {
      padding: 6px 10px;
      font-size: 0.8em;
    }
    
    /* Ø´Ø±ÙŠØ· ØªÙ…Ø±ÙŠØ± Ø£Ø¶ÙŠÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ§Ù„ */
    .messages::-webkit-scrollbar {
      width: 6px;
    }
  }

  /* Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØµÙˆØ± */
  .message img {
    max-width: 250px;
    border-radius: 10px;
    margin-top: 5px;
    box-shadow: 0 3px 8px rgba(0,0,0,0.1);
  }

  /* Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØµÙˆØª */
  .audio-message {
    width: 100%;
    margin-top: 5px;
    background: #f5f5f5;
    border-radius: 20px;
    padding: 8px;
  }

  /* Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ³Ø¬ÙŠÙ„ */
  .recording-indicator {
    display: none;
    position: fixed;
    bottom: 90px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(220, 53, 69, 0.9);
    color: white;
    padding: 10px 20px;
    border-radius: 30px;
    font-weight: bold;
    z-index: 100;
    animation: pulse 1.5s infinite;
  }

  /* Ù†Ø§ÙØ°Ø© Ø¥Ù‡Ø¯Ø§Ø¡ Ø§Ù„Ù†Ù‚Ø§Ø· */
  .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.7);
    z-index: 1000;
    justify-content: center;
    align-items: center;
  }

  .modal-content {
    background: #fff;
    padding: 30px;
    border-radius: 15px;
    width: 90%;
    max-width: 450px;
    text-align: center;
    box-shadow: 0 15px 40px rgba(0,0,0,0.3);
    animation: slideDown 0.4s ease;
  }

  .modal-content h3 {
    margin-top: 0;
    color: #2a5298;
    border-bottom: 2px solid #f0f0f0;
    padding-bottom: 15px;
    margin-bottom: 20px;
  }

  .modal-input {
    width: 100%;
    padding: 14px;
    font-size: 16px;
    border-radius: 10px;
    border: 2px solid #e0e0e0;
    margin: 15px 0;
    text-align: center;
    transition: all 0.3s;
  }

  .modal-input:focus {
    border-color: #2a5298;
    box-shadow: 0 0 10px rgba(42, 82, 152, 0.2);
    outline: none;
  }

  .modal-buttons {
    display: flex;
    justify-content: space-between;
    margin-top: 20px;
    gap: 15px;
  }

  .modal-btn {
    flex: 1;
    padding: 14px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-size: 16px;
    font-weight: 600;
    transition: all 0.3s;
    color: white;
  }

  .modal-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 5px 12px rgba(0,0,0,0.15);
  }

  .confirm-btn {
    background: linear-gradient(to right, #28a745, #218838);
  }

  .cancel-btn {
    background: linear-gradient(to right, #6c757d, #5a6268);
  }
  
  /* Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¨ÙˆØª Ø§Ù„Ø¯ÙŠÙ†ÙŠ */
  .bot-message .message-content {
    background: #f0f7ff;
    border: 1px solid #d1e7ff;
  }
  
  /* Ø¥Ø·Ø§Ø± Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨ */
  .youtube-frame {
    width: 100%;
    height: 200px;
    border-radius: 10px;
    margin-top: 15px;
    border: none;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  }
  
  /* Ù…Ø¤Ù‚Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„ */
  .recording-timer {
    color: white;
    font-weight: bold;
    margin-left: 10px;
  }
  
  /* Ø£Ù†ÙŠÙ…ÙŠØ´Ù† */
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  @keyframes slideDown {
    from { opacity: 0; transform: translateY(-30px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  @keyframes pulse {
    0% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7); }
    70% { box-shadow: 0 0 0 15px rgba(220, 53, 69, 0); }
    100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); }
  }
  
  /* Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø®Ø·Ø£ */
  .error-message {
    color: #dc3545;
    font-size: 0.9em;
    margin-top: -15px;
    margin-bottom: 10px;
    text-align: right;
    display: none;
  }
  
  /* Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
  .loading {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 3px solid rgba(255,255,255,0.3);
    border-radius: 50%;
    border-top-color: #fff;
    animation: spin 1s ease-in-out infinite;
    margin-right: 10px;
  }
  
  @keyframes spin {
    to { transform: rotate(360deg); }
  }
  
  /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØªØµÙ„ÙŠÙ† */
  .online-users {
    background: rgba(245, 247, 250, 0.9);
    padding: 10px 15px;
    border-bottom: 1px solid #eee;
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    align-items: center;
  }
  
  .online-users-title {
    font-weight: bold;
    color: #2a5298;
    margin-right: 5px;
  }
  
  .user-badge {
    display: flex;
    align-items: center;
    background: #e3f2fd;
    padding: 5px 10px;
    border-radius: 15px;
    font-size: 0.9em;
    gap: 5px;
  }
  
  .user-badge-icon {
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: #2a5298;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.7em;
    font-weight: bold;
  }
  
  .typing-indicator {
    font-style: italic;
    color: #666;
    font-size: 0.9em;
    margin-top: 5px;
    padding: 0 15px;
  }
</style>
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
</head>
<body>

<!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
<div class="login-container" id="loginContainer">
  <div id="loginBox">
    <h2>Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø´Ø§Øª</h2>
    <input type="text" id="username" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" />
    <div id="usernameError" class="error-message">ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ù…Ø³ØªØ®Ø¯Ù… ØµØ­ÙŠØ­</div>
    
    <button id="loginBtn">Ø¯Ø®ÙˆÙ„</button>
  </div>
</div>

<!-- Ù†Ø§ÙØ°Ø© Ø¥Ù‡Ø¯Ø§Ø¡ Ø§Ù„Ù†Ù‚Ø§Ø· -->
<div id="giftPointsModal" class="modal">
  <div class="modal-content">
    <h3>Ø¥Ù‡Ø¯Ø§Ø¡ Ù†Ù‚Ø§Ø· Ø¥Ù„Ù‰: <span id="giftToUsername" style="color:#2a5298;"></span></h3>
    <input type="number" id="giftPointsAmount" min="1" max="9000000000" value="100" 
           placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ù‚Ø§Ø· Ù…Ù† 1 Ø¥Ù„Ù‰ 9,000,000,000" class="modal-input" />
    <div class="modal-buttons">
      <button class="modal-btn cancel-btn" id="cancelGift">Ø¥Ù„ØºØ§Ø¡</button>
      <button class="modal-btn confirm-btn" id="confirmGift">Ø¥Ù‡Ø¯Ø§Ø¡</button>
    </div>
  </div>
</div>

<!-- Ù†Ø§ÙØ°Ø© Ø¨ÙˆØª Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨ -->
<div id="botModal" class="modal">
  <div class="modal-content">
    <h3>ØªØ´ØºÙŠÙ„ Ø£ØºÙ†ÙŠØ© Ù…Ù† Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨</h3>
    <input type="text" id="youtubeInput" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· Ø£ØºÙ†ÙŠØ© ÙŠÙˆØªÙŠÙˆØ¨" class="modal-input" />
    <iframe class="youtube-frame" id="youtubeFrame" src="" 
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
            allowfullscreen></iframe>
    <div class="modal-buttons">
      <button class="modal-btn cancel-btn" id="cancelBot">Ø¥Ù„ØºØ§Ø¡</button>
      <button class="modal-btn confirm-btn" id="playSong">ØªØ´ØºÙŠÙ„</button>
    </div>
  </div>
</div>

<!-- Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ³Ø¬ÙŠÙ„ -->
<div class="recording-indicator" id="recordingIndicator">
  <span>â—</span> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„... 
  <span class="recording-timer" id="recordingTimer">0:00</span>
</div>

<!-- ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø´Ø§Øª -->
<div id="chatContainer">
  <div class="chat-header">
    <div style="display:flex; align-items:center; gap:15px;">
      <span id="userNameDisplay">
        <span class="user-icon" id="userIcon">U</span>
        Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: 
      </span>
      <button id="pointsBtn" class="header-btn">
        <span>ğŸ’</span> Ù†Ù‚Ø§Ø·ÙŠ
      </button>
    </div>
    <div id="headerButtons" style="display:flex; align-items:center; gap:10px;">
      <button id="bgBtn" class="header-btn" title="ØªØºÙŠÙŠØ± Ø§Ù„Ø®Ù„ÙÙŠØ©">
        <span>ğŸ¨</span> Ø®Ù„ÙÙŠØ©
      </button>
      <button id="botBtn" class="header-btn" title="ØªØ´ØºÙŠÙ„ Ø£ØºÙ†ÙŠØ©">
        <span>ğŸµ</span> Ø¨ÙˆØª
      </button>
      <button id="deleteBtn" class="header-btn" title="Ù…Ø³Ø­ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„">
        <span>ğŸ§¹</span> Ù…Ø³Ø­
      </button>
      <button id="logoutBtn" class="header-btn">
        <span>ğŸšª</span> ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬
      </button>
    </div>
  </div>
  
  <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØªØµÙ„ÙŠÙ† -->
  <div class="online-users" id="onlineUsers">
    <span class="online-users-title">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø§Ù„Ù…ØªØµÙ„ÙˆÙ†:</span>
    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¦Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
  </div>
  
  <div class="messages" id="messages"></div>
  
  <!-- Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø© -->
  <div class="typing-indicator" id="typingIndicator"></div>
  
  <div class="features" style="padding:15px; background:#f9f9f9; border-top:1px solid #eee;">
    <div style="display:flex; align-items:center; gap:10px; font-size:1.1em;">
      <span>ğŸ’ Ø§Ù„Ù†Ù‚Ø§Ø·:</span>
      <span id="pointsDisplay" style="font-weight:bold; color:#2a5298;">0</span>
    </div>
    <div id="featureStatus" style="margin-top:10px; font-size:0.95em; color:#555; line-height:1.6;"></div>
  </div>
  <div class="input-area">
    <input type="text" id="messageInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..." />
    <button id="imageBtn" class="input-btn" title="Ø¥Ø±Ø³Ø§Ù„ ØµÙˆØ±Ø©">ğŸ–¼ï¸</button>
    <button id="voiceBtn" class="input-btn" title="Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ØµÙˆØªÙŠØ©">ğŸ™ï¸</button>
    <button id="sendBtn" class="input-btn" title="Ø¥Ø±Ø³Ø§Ù„">â¤</button>
  </div>
</div>

<!-- Ø¹Ù†Ø§ØµØ± Ù…Ù„ÙØ§Øª Ù…Ø®ÙÙŠØ© -->
<input type="file" id="audioFileInput" accept="audio/*" style="display:none" />
<input type="file" id="imageFileInput" accept="image/*" style="display:none" />
<input type="file" id="bgImageFileInput" accept="image/*" style="display:none" />

<script>
  // Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyDAMY9-F5d7wrNSRutVX9e7x7bFZXTkdL8",
    authDomain: "same-fdf6c.firebaseapp.com",
    projectId: "same-fdf6c",
    storageBucket: "same-fdf6c.appspot.com",
    messagingSenderId: "930026060406",
    appId: "1:930026060406:web:0b48dc568d710984003d57",
    measurementId: "G-CCFSFBJL1V"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const database = firebase.database();

  // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø­Ø§Ù„Ø©
  let username = '';
  let points = 0;
  let botInterval;
  let mediaRecorder;
  let audioChunks = [];
  let recordingTimer;
  let recordingSeconds = 0;
  let isRecording = false;
  let isTyping = false;
  let typingTimeout = null;
  let onlineUsers = {};

  // Ø¹Ù†Ø§ØµØ± DOM
  const loginContainer = document.getElementById('loginContainer');
  const chatContainer = document.getElementById('chatContainer');
  const loginBtn = document.getElementById('loginBtn');
  const logoutBtn = document.getElementById('logoutBtn');
  const sendBtn = document.getElementById('sendBtn');
  const voiceBtn = document.getElementById('voiceBtn');
  const imageBtn = document.getElementById('imageBtn');
  const pointsBtn = document.getElementById('pointsBtn');
  const deleteBtn = document.getElementById('deleteBtn');
  const bgBtn = document.getElementById('bgBtn');
  const botBtn = document.getElementById('botBtn');
  const audioFileInput = document.getElementById('audioFileInput');
  const imageFileInput = document.getElementById('imageFileInput');
  const bgImageFileInput = document.getElementById('bgImageFileInput');
  const messagesDiv = document.getElementById('messages');
  const pointsDisplay = document.getElementById('pointsDisplay');
  const userNameDisplay = document.getElementById('userNameDisplay');
  const userIcon = document.getElementById('userIcon');
  const recordingIndicator = document.getElementById('recordingIndicator');
  const recordingTimerElem = document.getElementById('recordingTimer');
  const onlineUsersDiv = document.getElementById('onlineUsers');
  const typingIndicator = document.getElementById('typingIndicator');

  // Ø¹Ù†Ø§ØµØ± Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø®Ø·Ø£
  const usernameError = document.getElementById('usernameError');

  // Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
  const giftPointsModal = document.getElementById('giftPointsModal');
  const botModal = document.getElementById('botModal');

  // ÙØ±Ø¶ÙŠØ©: Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„ Ù‡Ùˆ "MASTER"
  const MASTER_USERNAME='MASTER';

  // Ø£Ø°ÙƒØ§Ø± Ø¯ÙŠÙ†ÙŠØ©
  const religiousReminders = [
    "Ø§Ù„Ù„Ù‡Ù… Ø¥Ù†ÙŠ Ø£Ø³Ø£Ù„Ùƒ Ø¹Ù„Ù…Ø§Ù‹ Ù†Ø§ÙØ¹Ø§Ù‹ØŒ ÙˆØ±Ø²Ù‚Ø§Ù‹ Ø·ÙŠØ¨Ø§Ù‹ØŒ ÙˆØ¹Ù…Ù„Ø§Ù‹ Ù…ØªÙ‚Ø¨Ù„Ø§Ù‹",
    "Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø­Ù…Ø¯Ù‡ØŒ Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡ Ø§Ù„Ø¹Ø¸ÙŠÙ…",
    "Ø§Ù„Ù„Ù‡Ù… Ø¥Ù†ÙŠ Ø£Ø¹ÙˆØ° Ø¨Ùƒ Ù…Ù† Ø§Ù„Ù‡Ù… ÙˆØ§Ù„Ø­Ø²Ù†ØŒ ÙˆØ§Ù„Ø¹Ø¬Ø² ÙˆØ§Ù„ÙƒØ³Ù„ØŒ ÙˆØ§Ù„Ø¨Ø®Ù„ ÙˆØ§Ù„Ø¬Ø¨Ù†ØŒ ÙˆØ¶Ù„Ø¹ Ø§Ù„Ø¯ÙŠÙ† ÙˆØºÙ„Ø¨Ø© Ø§Ù„Ø±Ø¬Ø§Ù„",
    "Ù„Ø§ Ø¥Ù„Ù‡ Ø¥Ù„Ø§ Ø§Ù„Ù„Ù‡ ÙˆØ­Ø¯Ù‡ Ù„Ø§ Ø´Ø±ÙŠÙƒ Ù„Ù‡ØŒ Ù„Ù‡ Ø§Ù„Ù…Ù„Ùƒ ÙˆÙ„Ù‡ Ø§Ù„Ø­Ù…Ø¯ ÙˆÙ‡Ùˆ Ø¹Ù„Ù‰ ÙƒÙ„ Ø´ÙŠØ¡ Ù‚Ø¯ÙŠØ±",
    "Ø§Ù„Ù„Ù‡Ù… Ø¥Ù†ÙŠ Ø£Ø³Ø£Ù„Ùƒ Ø§Ù„Ø¬Ù†Ø© ÙˆÙ…Ø§ Ù‚Ø±Ø¨ Ø¥Ù„ÙŠÙ‡Ø§ Ù…Ù† Ù‚ÙˆÙ„ Ø£Ùˆ Ø¹Ù…Ù„ØŒ ÙˆØ£Ø¹ÙˆØ° Ø¨Ùƒ Ù…Ù† Ø§Ù„Ù†Ø§Ø± ÙˆÙ…Ø§ Ù‚Ø±Ø¨ Ø¥Ù„ÙŠÙ‡Ø§ Ù…Ù† Ù‚ÙˆÙ„ Ø£Ùˆ Ø¹Ù…Ù„",
    "Ø§Ù„Ù„Ù‡Ù… Ø§ØºÙØ± Ù„ÙŠ Ø°Ù†Ø¨ÙŠ ÙƒÙ„Ù‡ØŒ Ø¯Ù‚Ù‡ ÙˆØ¬Ù„Ù‡ØŒ ÙˆØ£ÙˆÙ„Ù‡ ÙˆØ¢Ø®Ø±Ù‡ØŒ ÙˆØ¹Ù„Ø§Ù†ÙŠØªÙ‡ ÙˆØ³Ø±Ù‡",
    "Ø§Ù„Ù„Ù‡Ù… Ø¥Ù†ÙŠ Ø£Ø³Ø£Ù„Ùƒ Ø§Ù„Ø¹ÙÙˆ ÙˆØ§Ù„Ø¹Ø§ÙÙŠØ© ÙÙŠ Ø§Ù„Ø¯Ù†ÙŠØ§ ÙˆØ§Ù„Ø¢Ø®Ø±Ø©",
    "Ø§Ù„Ù„Ù‡Ù… Ø§Ù‡Ø¯Ù†ÙŠ ÙˆØ³Ø¯Ø¯Ù†ÙŠØŒ Ø§Ù„Ù„Ù‡Ù… Ø¥Ù†ÙŠ Ø£Ø³Ø£Ù„Ùƒ Ø§Ù„Ù‡Ø¯Ù‰ ÙˆØ§Ù„Ø³Ø¯Ø§Ø¯",
    "Ø§Ù„Ù„Ù‡Ù… Ø¥Ù†Ùƒ Ø¹ÙÙˆ ØªØ­Ø¨ Ø§Ù„Ø¹ÙÙˆ ÙØ§Ø¹Ù Ø¹Ù†ÙŠ",
    "Ø§Ù„Ù„Ù‡Ù… Ø¥Ù†ÙŠ Ø£Ø¹ÙˆØ° Ø¨Ùƒ Ù…Ù† Ø²ÙˆØ§Ù„ Ù†Ø¹Ù…ØªÙƒØŒ ÙˆØªØ­ÙˆÙ„ Ø¹Ø§ÙÙŠØªÙƒØŒ ÙˆÙØ¬Ø§Ø¡Ø© Ù†Ù‚Ù…ØªÙƒØŒ ÙˆØ¬Ù…ÙŠØ¹ Ø³Ø®Ø·Ùƒ"
  ];

  // Ø¯Ø§Ù„Ø© Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
  function isValidUsername(username) {
    return username.length >= 3 && username.length <= 20;
  }

  // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø®Ø·Ø£
  function hideAllErrorMessages() {
    usernameError.style.display = 'none';
  }

  // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØªØµÙ„ÙŠÙ†
  function updateOnlineUsers() {
    onlineUsersDiv.innerHTML = '<span class="online-users-title">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø§Ù„Ù…ØªØµÙ„ÙˆÙ†:</span>';
    
    Object.keys(onlineUsers).forEach(user => {
      if (user !== username && onlineUsers[user].online) {
        const userBadge = document.createElement('div');
        userBadge.className = 'user-badge';
        userBadge.innerHTML = `
          <span class="user-badge-icon">${user.charAt(0).toUpperCase()}</span>
          <span>${user}</span>
        `;
        onlineUsersDiv.appendChild(userBadge);
      }
    });
  }

  // Ø¥Ø±Ø³Ø§Ù„ Ø­Ø§Ù„Ø© Ø§Ù„ÙƒØªØ§Ø¨Ø©
  function sendTypingStatus(isTyping) {
    if (username) {
      database.ref('users/' + username).update({
        typing: isTyping
      });
    }
  }

  // ØªØ­Ø¯ÙŠØ« Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø©
  function updateTypingIndicator() {
    let typingUsers = [];
    
    Object.keys(onlineUsers).forEach(user => {
      if (user !== username && onlineUsers[user].typing) {
        typingUsers.push(user);
      }
    });
    
    if (typingUsers.length > 0) {
      if (typingUsers.length === 1) {
        typingIndicator.textContent = `${typingUsers[0]} ÙŠÙƒØªØ¨ Ø§Ù„Ø¢Ù†...`;
      } else if (typingUsers.length === 2) {
        typingIndicator.textContent = `${typingUsers[0]} Ùˆ ${typingUsers[1]} ÙŠÙƒØªØ¨Ø§Ù† Ø§Ù„Ø¢Ù†...`;
      } else {
        typingIndicator.textContent = 'Ø¹Ø¯Ø© Ø£Ø´Ø®Ø§Øµ ÙŠÙƒØªØ¨ÙˆÙ† Ø§Ù„Ø¢Ù†...';
      }
    } else {
      typingIndicator.textContent = '';
    }
  }

  // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
  async function login() {
    hideAllErrorMessages();
    
    const nameInput = document.getElementById('username').value.trim();
    
    if (!nameInput) {
      usernameError.textContent = 'ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…';
      usernameError.style.display = 'block';
      return;
    }
    
    if (!isValidUsername(nameInput)) {
      usernameError.textContent = 'ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† 3 Ø¥Ù„Ù‰ 20 Ø­Ø±ÙØ§Ù‹';
      usernameError.style.display = 'block';
      return;
    }
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    const userRef = database.ref('users/' + nameInput);
    userRef.once('value').then(snapshot => {
      const userData = snapshot.val();
      
      if (userData) {
        // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯: ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        username = nameInput;
        points = userData.points || 0;
        
        // Ø­ÙØ¸ ÙÙŠ localStorage
        localStorage.setItem('username', username);
        localStorage.setItem('points', points);
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø´Ø§Øª
        loginContainer.style.display = 'none';
        chatContainer.style.display = 'flex';
        updateUserDisplay();
        updatePointsDisplay();
        
        // Ø¨Ø¯Ø¡ Ø§Ù„Ø¨ÙˆØª Ø§Ù„Ø¯ÙŠÙ†ÙŠ
        if (username !== MASTER_USERNAME) {
          startReligiousBot();
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        database.ref('users/' + username).update({
          online: true,
          typing: false,
          lastActive: firebase.database.ServerValue.TIMESTAMP
        });
        
        // Ø§Ø³ØªÙ…Ø¹ Ù„Ù„ØªØºÙŠØ±Ø§Øª ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        database.ref('users').on('value', (snapshot) => {
          onlineUsers = snapshot.val() || {};
          updateOnlineUsers();
          updateTypingIndicator();
        });
        
        // Ø§Ø³ØªÙ…Ø¹ Ù„Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
        database.ref('messages').limitToLast(100).on('child_added', (snapshot) => {
          const message = snapshot.val();
          if (message.sender !== username) {
            addMessage(message.content, 'received', message.sender);
          }
        });
        
        // Ø§Ø³ØªÙ…Ø¹ Ù„Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
        database.ref('messages').on('value', (snapshot) => {
          if (snapshot.val() === null) {
            messagesDiv.innerHTML = '';
          }
        });
        
        // Ø§Ø³ØªÙ…Ø¹ Ù„Ø£ØºÙ†ÙŠØ© Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨ Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        database.ref('currentSong').on('value', (snapshot) => {
          const song = snapshot.val();
          if (song) {
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø£ØºÙ†ÙŠØ©ØŒ Ù†Ø­Ø¯Ø« Ø¥Ø·Ø§Ø± Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨
            const embedUrl = `https://www.youtube.com/embed/${song.videoId}?autoplay=1`;
            document.getElementById('youtubeFrame').src = embedUrl;
          }
        });
      } else {
        // Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯: Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨
        username = nameInput;
        points = 0;
        
        // Ø­ÙØ¸ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        userRef.set({
          points: points,
          online: true,
          typing: false,
          lastActive: firebase.database.ServerValue.TIMESTAMP
        });
        
        // Ø­ÙØ¸ ÙÙŠ localStorage
        localStorage.setItem('username', username);
        localStorage.setItem('points', points);
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø´Ø§Øª
        loginContainer.style.display = 'none';
        chatContainer.style.display = 'flex';
        updateUserDisplay();
        updatePointsDisplay();
        
        // Ø¨Ø¯Ø¡ Ø§Ù„Ø¨ÙˆØª Ø§Ù„Ø¯ÙŠÙ†ÙŠ
        if (username !== MASTER_USERNAME) {
          startReligiousBot();
        }
        
        // Ø§Ø³ØªÙ…Ø¹ Ù„Ù„ØªØºÙŠØ±Ø§Øª ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        database.ref('users').on('value', (snapshot) => {
          onlineUsers = snapshot.val() || {};
          updateOnlineUsers();
          updateTypingIndicator();
        });
        
        // Ø§Ø³ØªÙ…Ø¹ Ù„Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
        database.ref('messages').limitToLast(100).on('child_added', (snapshot) => {
          const message = snapshot.val();
          if (message.sender !== username) {
            addMessage(message.content, 'received', message.sender);
          }
        });
        
        // Ø§Ø³ØªÙ…Ø¹ Ù„Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
        database.ref('messages').on('value', (snapshot) => {
          if (snapshot.val() === null) {
            messagesDiv.innerHTML = '';
          }
        });
        
        // Ø§Ø³ØªÙ…Ø¹ Ù„Ø£ØºÙ†ÙŠØ© Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨ Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        database.ref('currentSong').on('value', (snapshot) => {
          const song = snapshot.val();
          if (song) {
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø£ØºÙ†ÙŠØ©ØŒ Ù†Ø­Ø¯Ø« Ø¥Ø·Ø§Ø± Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨
            const embedUrl = `https://www.youtube.com/embed/${song.videoId}?autoplay=1`;
            document.getElementById('youtubeFrame').src = embedUrl;
          }
        });
        
        // Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨
        const newMessageRef = database.ref('messages').push();
        newMessageRef.set({
          sender: 'Ø§Ù„Ù†Ø¸Ø§Ù…',
          content: { type: 'text', data: `Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ù„Ø´Ø§ØªØŒ ${username}!` },
          timestamp: firebase.database.ServerValue.TIMESTAMP
        });
      }
    });
  }

  // Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
  window.onload = async () => {
    hideAllErrorMessages();
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ ÙÙŠ localStorage
    const savedUsername = localStorage.getItem('username');
    const savedPoints = localStorage.getItem('points');
    
    if (savedUsername) {
      // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ
      username = savedUsername;
      points = parseInt(savedPoints) || 0;
      
      loginContainer.style.display = 'none';
      chatContainer.style.display = 'flex';
      updateUserDisplay();
      updatePointsDisplay();
      
      // Ø¨Ø¯Ø¡ Ø§Ù„Ø¨ÙˆØª Ø§Ù„Ø¯ÙŠÙ†ÙŠ
      if (username !== MASTER_USERNAME) {
        startReligiousBot();
      }
      
      // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
      database.ref('users/' + username).update({
        online: true,
        typing: false,
        lastActive: firebase.database.ServerValue.TIMESTAMP
      });
      
      // Ø§Ø³ØªÙ…Ø¹ Ù„Ù„ØªØºÙŠØ±Ø§Øª ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
      database.ref('users').on('value', (snapshot) => {
        onlineUsers = snapshot.val() || {};
        updateOnlineUsers();
        updateTypingIndicator();
      });
      
      // Ø§Ø³ØªÙ…Ø¹ Ù„Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
      database.ref('messages').limitToLast(100).on('child_added', (snapshot) => {
        const message = snapshot.val();
        if (message.sender !== username) {
          addMessage(message.content, 'received', message.sender);
        }
      });
      
      // Ø§Ø³ØªÙ…Ø¹ Ù„Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
      database.ref('messages').on('value', (snapshot) => {
        if (snapshot.val() === null) {
          messagesDiv.innerHTML = '';
        }
      });
      
      // Ø§Ø³ØªÙ…Ø¹ Ù„Ø£ØºÙ†ÙŠØ© Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨ Ø§Ù„Ø­Ø§Ù„ÙŠØ©
      database.ref('currentSong').on('value', (snapshot) => {
        const song = snapshot.val();
        if (song) {
          // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø£ØºÙ†ÙŠØ©ØŒ Ù†Ø­Ø¯Ø« Ø¥Ø·Ø§Ø± Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨
          const embedUrl = `https://www.youtube.com/embed/${song.videoId}?autoplay=1`;
          document.getElementById('youtubeFrame').src = embedUrl;
        }
      });
    } else {
      // Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„: Ø¥Ø¸Ù‡Ø§Ø± Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„
      loginContainer.style.display = 'flex';
    }
    
    // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø®Ù„ÙÙŠØ© Ø§Ù„ØµÙØ­Ø©
    const savedBg = localStorage.getItem('chatBackground');
    if (savedBg) {
      document.body.style.backgroundImage = `url(${savedBg})`;
      document.body.style.backgroundSize = 'cover';
    }
  };

  // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
  function updateUserDisplay() {
    userNameDisplay.textContent = `Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${username}`;
    userIcon.textContent = username.charAt(0).toUpperCase();
    
    // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„Ù…Ø³Ø­ ÙÙ‚Ø· Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„
    if (username === MASTER_USERNAME) {
      deleteBtn.style.display = 'flex';
    } else {
      deleteBtn.style.display = 'none';
    }
  }

  // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
  logoutBtn.onclick = () => {
    // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¨ÙˆØª Ø§Ù„Ø¯ÙŠÙ†ÙŠ
    if (botInterval) {
      clearInterval(botInterval);
    }
    
    // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø¬Ø§Ø±ÙŠØ§Ù‹
    if (isRecording) {
      stopRecording();
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    if (username) {
      database.ref('users/' + username).update({
        online: false,
        typing: false,
        lastActive: firebase.database.ServerValue.TIMESTAMP
      });
    }
    
    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ†
    database.ref('users').off();
    database.ref('messages').off();
    database.ref('currentSong').off();
    
    // Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ù„Ø³Ø©
    localStorage.removeItem('username');
    localStorage.removeItem('points');
    
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª
    username = '';
    points = 0;
    document.getElementById('username').value = '';
    loginContainer.style.display = 'flex';
    chatContainer.style.display = 'none';
  };

  // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ù†ØµÙŠØ©
  function sendMessage() {
    const text = document.getElementById('messageInput').value.trim();
    if (text !== '') {
      // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¥Ù„Ù‰ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
      const newMessageRef = database.ref('messages').push();
      newMessageRef.set({
        sender: username,
        content: { type: 'text', data: text },
        timestamp: firebase.database.ServerValue.TIMESTAMP
      });
      
      // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙÙˆØ±Ø§Ù‹ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
      addMessage({ type: 'text', data: text }, 'sent', username);
      
      document.getElementById('messageInput').value = '';
      
      // Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø©
      isTyping = false;
      sendTypingStatus(false);
      
      // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù†Ù‚Ø§Ø·
      if (username !== MASTER_USERNAME) {
        increasePoints(1);
      }
    }
  }

  sendBtn.onclick = sendMessage;
  
  // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„ÙƒØªØ§Ø¨Ø© ÙÙŠ Ø­Ù‚Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
  document.getElementById('messageInput').addEventListener('input', () => {
    if (!isTyping) {
      isTyping = true;
      sendTypingStatus(true);
    }
    
    clearTimeout(typingTimeout);
    typingTimeout = setTimeout(() => {
      isTyping = false;
      sendTypingStatus(false);
    }, 3000);
  });
  
  document.getElementById('messageInput').addEventListener('keydown', (e) => {
    if (e.key === 'Enter') {
      e.preventDefault();
      sendMessage();
    }
  });

  // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø¯Ø±Ø¯Ø´Ø©
  function addMessage(content, type, sender) {
    const msgDiv = document.createElement('div');
    msgDiv.className = `message ${type === 'sent' ? 'sent' : 'received'}`;
    
    // Ø¥Ø¶Ø§ÙØ© ÙƒÙ„Ø§Ø³ Ù„Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¯ÙŠÙ†ÙŠØ©
    if (sender === 'Ø§Ù„Ø¨ÙˆØª Ø§Ù„Ø¯ÙŠÙ†ÙŠ') {
      msgDiv.classList.add('bot-message');
    }

    const senderSpan = document.createElement('div');
    senderSpan.className = 'sender-name';
    
    // Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…Ø±Ø³Ù„
    const senderIcon = document.createElement('span');
    senderIcon.className = 'sender-icon';
    senderIcon.textContent = sender.charAt(0).toUpperCase();
    
    senderSpan.appendChild(senderIcon);
    senderSpan.appendChild(document.createTextNode(sender));
    
    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ Ù‡Ùˆ MASTER ÙˆØ£Ø³Ù… Ø§Ù„Ù…Ø±Ø³Ù„ Ù„ÙŠØ³ MASTER
    if (username === MASTER_USERNAME && sender !== MASTER_USERNAME && sender !== 'Ø§Ù„Ø¨ÙˆØª Ø§Ù„Ø¯ÙŠÙ†ÙŠ') {
      senderSpan.classList.add('clickable');
      senderSpan.dataset.username = sender;
    }

    const contentDiv = document.createElement('div');
    contentDiv.className = 'message-content';

    if (content.type === 'text') {
      const textSpan = document.createElement('div');
      textSpan.className = 'message-text';
      textSpan.textContent = content.data;
      
      // ØªØºÙŠÙŠØ± Ù„ÙˆÙ† Ø§Ù„Ù†Øµ Ø¹Ù†Ø¯ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù€ 500 Ù†Ù‚Ø·Ø©
      if (points >= 500 && sender !== 'MASTER') {
        textSpan.style.color = '#d32f2f';
        textSpan.style.fontWeight = 'bold';
      }
      
      contentDiv.appendChild(textSpan);
    } else if (content.type === 'image') {
      const img = document.createElement('img');
      img.src = content.data;
      img.style.maxWidth = '250px';
      img.style.borderRadius = '10px';
      contentDiv.appendChild(img);
    } else if (content.type === 'audio') {
      const audio = document.createElement('audio');
      audio.controls = true;
      audio.src = content.data;
      audio.className = 'audio-message';
      audio.controlsList = 'nodownload';
      contentDiv.appendChild(audio);
    }

    msgDiv.appendChild(senderSpan);
    msgDiv.appendChild(contentDiv);
    messagesDiv.appendChild(msgDiv);
    
    // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù„Ù„Ø£Ø³ÙÙ„
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  }

  // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù†Ù‚Ø§Ø·
  function increasePoints(amount) {
    points += amount;
    if (points > 1000000000) points = 1000000000;
    updatePointsDisplay();

    // ØªØ­Ø¯ÙŠØ« ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    if (username && username !== MASTER_USERNAME) {
      database.ref('users/' + username).update({
        points: points
      });
    }

    // ØªØ­Ø¯ÙŠØ« ÙÙŠ localStorage
    localStorage.setItem('points', points);

    // Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…ÙŠØ²Ø§Øª
    if (points >= 2000 && points - amount < 2000) {
      alert('ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ø¦Ù„ ØµÙˆØªÙŠØ© Ù…Ø¯ØªÙ‡Ø§ Ø¯Ù‚ÙŠÙ‚Ø© ÙƒØ§Ù…Ù„Ø©.');
    }
    if (points >= 10000 && points - amount < 10000) {
      alert('ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø¥Ø±Ø³Ø§Ù„ ØµÙˆØ± Ø­Ù‚ÙŠÙ‚ÙŠØ©.');
    }
  }

  // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ù†Ù‚Ø§Ø·
  function updatePointsDisplay() {
    pointsDisplay.textContent = points;
    checkFeatures();
  }

  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©
  function checkFeatures() {
    const featureStatus = document.getElementById('featureStatus');
    featureStatus.innerHTML = '';
    
    if (points >= 500) {
      featureStatus.innerHTML += '<p>âœ… ØªØºÙŠÙŠØ± Ù„ÙˆÙ† Ø§Ù„Ù†Øµ Ø¹Ù†Ø¯ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ 500 Ù†Ù‚Ø·Ø©!</p>';
    }
    if (points >= 2000) {
      featureStatus.innerHTML += '<p>âœ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ø¦Ù„ ØµÙˆØªÙŠØ© Ù„Ù…Ø¯Ø© Ø¯Ù‚ÙŠÙ‚Ø© ÙƒØ§Ù…Ù„Ø©!</p>';
    }
    if (points >= 10000) {
      featureStatus.innerHTML += '<p>âœ… Ø¥Ø±Ø³Ø§Ù„ ØµÙˆØ± Ø­Ù‚ÙŠÙ‚ÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Øª!</p>';
    }
  }

  // Ø¹Ø±Ø¶ Ø§Ù„Ù†Ù‚Ø§Ø·
  pointsBtn.onclick = () => {
    alert(`Ù†Ù‚Ø§Ø·Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠØ©: ${points}`);
  };

  // Ø¥Ø±Ø³Ø§Ù„ ØµÙˆØ±Ø©
  imageBtn.onclick = () => {
    if (points >= 10000 || username === MASTER_USERNAME) {
      imageFileInput.click();
    } else {
      alert('ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ 10000 Ù†Ù‚Ø·Ø© Ù„Ø¥Ø±Ø³Ø§Ù„ ØµÙˆØ±Ø©.');
    }
  };

  // Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø©
  imageFileInput.onchange = () => {
    const file = imageFileInput.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = () => {
        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        const newMessageRef = database.ref('messages').push();
        newMessageRef.set({
          sender: username,
          content: { type: 'image', data: reader.result },
          timestamp: firebase.database.ServerValue.TIMESTAMP
        });
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØµÙˆØ±Ø© ÙÙˆØ±Ø§Ù‹ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
        addMessage({ type: 'image', data: reader.result }, 'sent', username);
        
        if (username !== MASTER_USERNAME) {
          increasePoints(1);
        }
      };
      reader.readAsDataURL(file);
    }
  };

  // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØªÙŠ
  function startRecording() {
    navigator.mediaDevices.getUserMedia({ audio: true })
      .then(stream => {
        mediaRecorder = new MediaRecorder(stream);
        audioChunks = [];
        
        mediaRecorder.ondataavailable = event => {
          audioChunks.push(event.data);
        };
        
        mediaRecorder.onstop = () => {
          const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
          const reader = new FileReader();
          reader.onload = () => {
            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØµÙˆØªÙŠØ© Ø¥Ù„Ù‰ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            const newMessageRef = database.ref('messages').push();
            newMessageRef.set({
              sender: username,
              content: { type: 'audio', data: reader.result },
              timestamp: firebase.database.ServerValue.TIMESTAMP
            });
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØµÙˆØªÙŠØ© ÙÙˆØ±Ø§Ù‹ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
            addMessage('Ø±Ø³Ø§Ù„Ø© ØµÙˆØªÙŠØ©', 'sent', username);
            addMessage({ type: 'audio', data: reader.result }, 'sent', username);
            
            if (username !== MASTER_USERNAME) {
              increasePoints(1);
            }
          };
          reader.readAsDataURL(audioBlob);
          
          // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†
          stream.getTracks().forEach(track => track.stop());
        };
        
        mediaRecorder.start();
        isRecording = true;
        recordingSeconds = 0;
        recordingIndicator.style.display = 'block';
        voiceBtn.innerHTML = 'â¹ï¸';
        
        // Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¤Ù‚Øª
        recordingTimer = setInterval(() => {
          recordingSeconds++;
          const minutes = Math.floor(recordingSeconds / 60);
          const seconds = recordingSeconds % 60;
          recordingTimerElem.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
          
          // Ø¥ÙŠÙ‚Ø§Ù Ø¹Ù†Ø¯ 60 Ø«Ø§Ù†ÙŠØ©
          if (recordingSeconds >= 60) {
            stopRecording();
          }
        }, 1000);
      })
      .catch(err => {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†:', err);
        alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£Ø°ÙˆÙ†Ø§Øª.');
      });
  }

  // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØªÙŠ
  function stopRecording() {
    if (mediaRecorder && mediaRecorder.state !== 'inactive') {
      mediaRecorder.stop();
      isRecording = false;
      clearInterval(recordingTimer);
      recordingIndicator.style.display = 'none';
      voiceBtn.innerHTML = 'ğŸ™ï¸';
    }
  }

  // Ø²Ø± Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØªÙŠ
  voiceBtn.onclick = () => {
    if (points < 2000 && username !== MASTER_USERNAME) {
      alert('ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ 2000 Ù†Ù‚Ø·Ø© Ù„Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ØµÙˆØªÙŠØ©.');
      return;
    }
    
    if (!isRecording) {
      startRecording();
    } else {
      stopRecording();
    }
  };

  // Ù…Ø³Ø­ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ (ÙÙ‚Ø· Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„)
  deleteBtn.onclick = () => { 
    if (username === MASTER_USERNAME) {
      // Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
      database.ref('messages').remove()
        .then(() => {
          alert('ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø¨Ù†Ø¬Ø§Ø­');
        })
        .catch(error => {
          alert('ÙØ´Ù„ Ù…Ø³Ø­ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„');
        });
    }
  };

  // Ø²Ø± ØªØºÙŠÙŠØ± Ø§Ù„Ø®Ù„ÙÙŠØ© (Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„ ÙÙ‚Ø·)
  bgBtn.onclick = () => {
    if (username === MASTER_USERNAME) {
      bgImageFileInput.click();
    }
  };

  // Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© Ø®Ù„ÙÙŠØ©
  bgImageFileInput.onchange = () => {
    const file = bgImageFileInput.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = () => {
        const imageUrl = reader.result;
        
        // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø®Ù„ÙÙŠØ©
        document.body.style.backgroundImage = `url(${imageUrl})`;
        document.body.style.backgroundSize = 'cover';
        
        // Ø­ÙØ¸ ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
        localStorage.setItem('chatBackground', imageUrl);
        
        alert('ØªÙ… ØªØºÙŠÙŠØ± Ø®Ù„ÙÙŠØ© Ø§Ù„Ø´Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!');
      };
      reader.readAsDataURL(file);
    }
  };

  // Ø²Ø± Ø¨ÙˆØª Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨ (Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„ ÙÙ‚Ø·)
  botBtn.onclick = () => {
    if (username === MASTER_USERNAME) {
      document.getElementById('youtubeInput').value = '';
      document.getElementById('youtubeFrame').src = '';
      botModal.style.display = 'flex';
    }
  };

  // ØªØ´ØºÙŠÙ„ Ø£ØºÙ†ÙŠØ© Ù…Ù† Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨
  document.getElementById('playSong').onclick = () => {
    const youtubeLink = document.getElementById('youtubeInput').value.trim();
    if (youtubeLink) {
      // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…Ø¹Ø±Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
      let videoId = '';
      if (youtubeLink.includes('youtube.com/watch?v=')) {
        videoId = youtubeLink.split('v=')[1].split('&')[0];
      } else if (youtubeLink.includes('youtu.be/')) {
        videoId = youtubeLink.split('youtu.be/')[1].split('?')[0];
      }
      
      if (videoId) {
        // ØªØ­Ø¯ÙŠØ« Ø¥Ø·Ø§Ø± Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
        const embedUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1`;
        document.getElementById('youtubeFrame').src = embedUrl;

        // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø¨Ø§Ù„Ø£ØºÙ†ÙŠØ©
        const newMessageRef = database.ref('messages').push();
        newMessageRef.set({
          sender: 'Ø¨ÙˆØª Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰',
          content: { type: 'text', data: `Ø£ØºÙ†ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©: ${youtubeLink}` },
          timestamp: firebase.database.ServerValue.TIMESTAMP
        });

        // Ø­ÙØ¸ Ø§Ù„Ø£ØºÙ†ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙÙŠ Ù…Ø³Ø§Ø± Ø®Ø§Øµ
        database.ref('currentSong').set({
          videoId: videoId,
          url: youtubeLink
        });
      } else {
        alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· ÙŠÙˆØªÙŠÙˆØ¨ ØµØ­ÙŠØ­');
      }
    } else {
      alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· Ø£ØºÙ†ÙŠØ© ÙŠÙˆØªÙŠÙˆØ¨');
    }
  };

  // Ø¥Ù„ØºØ§Ø¡ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¨ÙˆØª
  document.getElementById('cancelBot').onclick = () => {
    botModal.style.display = 'none';
  };

  // Ø¥Ù„ØºØ§Ø¡ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ù‡Ø¯Ø§Ø¡
  document.getElementById('cancelGift').onclick = () => {
    giftPointsModal.style.display = 'none';
  };

  // Ø¨Ø¯Ø¡ Ø§Ù„Ø¨ÙˆØª Ø§Ù„Ø¯ÙŠÙ†ÙŠ
  function startReligiousBot() {
    // Ø¥Ø±Ø³Ø§Ù„ Ø°ÙƒØ± ÙÙˆØ±ÙŠ
    setTimeout(() => {
      const randomReminder = religiousReminders[Math.floor(Math.random() * religiousReminders.length)];
      const newMessageRef = database.ref('messages').push();
      newMessageRef.set({
        sender: 'Ø§Ù„Ø¨ÙˆØª Ø§Ù„Ø¯ÙŠÙ†ÙŠ',
        content: { type: 'text', data: randomReminder },
        timestamp: firebase.database.ServerValue.TIMESTAMP
      });
    }, 3000);
    
    // Ø¥Ø±Ø³Ø§Ù„ Ø°ÙƒØ± ÙƒÙ„ 10 Ø¯Ù‚Ø§Ø¦Ù‚
    botInterval = setInterval(() => {
      const randomReminder = religiousReminders[Math.floor(Math.random() * religiousReminders.length)];
      const newMessageRef = database.ref('messages').push();
      newMessageRef.set({
        sender: 'Ø§Ù„Ø¨ÙˆØª Ø§Ù„Ø¯ÙŠÙ†ÙŠ',
        content: { type: 'text', data: randomReminder },
        timestamp: firebase.database.ServerValue.TIMESTAMP
      });
    }, 10 * 60 * 1000); // 10 Ø¯Ù‚Ø§Ø¦Ù‚
  }

  // Ø¥Ù‡Ø¯Ø§Ø¡ Ø§Ù„Ù†Ù‚Ø§Ø· Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„
  messagesDiv.addEventListener('click', (e) => {
    if (username === MASTER_USERNAME && e.target.classList.contains('clickable')) {
      const targetUser = e.target.dataset.username;
      if (targetUser && targetUser !== MASTER_USERNAME) {
        document.getElementById('giftToUsername').textContent = targetUser;
        document.getElementById('giftPointsAmount').value = '100';
        giftPointsModal.style.display = 'flex';
        giftPointsModal.dataset.targetUser = targetUser;
      }
    }
  });

  // ØªØ£ÙƒÙŠØ¯ Ø¥Ù‡Ø¯Ø§Ø¡ Ø§Ù„Ù†Ù‚Ø§Ø·
  document.getElementById('confirmGift').onclick = () => {
    const targetUser = giftPointsModal.dataset.targetUser;
    const pointsAmount = parseInt(document.getElementById('giftPointsAmount').value);
    
    if (pointsAmount > 0 && pointsAmount <= 9000000000) {
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù‚Ø§Ø· ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
      const userRef = database.ref('users/' + targetUser);
      userRef.once('value').then(snapshot => {
        const userData = snapshot.val();
        if (userData) {
          const newPoints = (userData.points || 0) + pointsAmount;
          userRef.update({
            points: newPoints
          });
          
          alert(`ØªÙ… Ø¥Ù‡Ø¯Ø§Ø¡ ${pointsAmount} Ù†Ù‚Ø·Ø© Ø¥Ù„Ù‰ ${targetUser} Ø¨Ù†Ø¬Ø§Ø­!`);
          
          // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ Ù‡Ùˆ Ø§Ù„Ù‡Ø¯Ù
          if (username === targetUser) {
            points = newPoints;
            updatePointsDisplay();
          }
        } else {
          alert('Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!');
        }
      });
      
      giftPointsModal.style.display = 'none';
    } else {
      alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ø¯Ø¯ ØµØ­ÙŠØ­ Ù…Ù† 1 Ø¥Ù„Ù‰ 9,000,000,000');
    }
  };
  
  // Ø²Ø± Ø§Ù„Ø¯Ø®ÙˆÙ„
  loginBtn.onclick = login;
  
  // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ù†Ø¯ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙØ­Ø©
  window.addEventListener('beforeunload', () => {
    if (username) {
      database.ref('users/' + username).update({
        online: false,
        typing: false,
        lastActive: firebase.database.ServerValue.TIMESTAMP
      });
    }
  });
</script>

</body>
</html>